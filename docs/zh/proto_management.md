[English](../en/proto_management.md)

# 前言

tRPC-Cpp 框架使用 `protobuf` 作为缺省的接口定义语言（IDL）, 服务之间调用时, proto 接口文件作为服务的对外用户界面, 应该有比较统一的管理方式。

常规的做法: 每个服务的 proto 文件自己管理, 服务需要互通时, 将 proto 文件 copy 一份, 然后通过 protoc 工具临时生成桩代码来使用, 这样的做法导致每个服务的 proto 文件出现多个副本, 不同 proto 文件的副本因为更新不及时, 导致上下游协议不一致，从而出现互通问题.

因此, tRPC-Cpp 框架这里推荐的 proto 文件依赖管理方式是: 对于服务的提供方, 把需要对外的 proto 文件放到统一的远程仓库管理(比如: 使用 github 的仓库或者内部私有的仓库); 对于服务的调用方, 只需要基于 bazel 构建工具自动拉取依赖的 proto 文件并生成桩代码即可.

# 基 于bazel 自动拉取远程 proto 文件的使用方式

步骤1: 拉取依赖服务的 proto 文件

在拉取之前, 需要确保依赖服务的 proto 文件已经在某个远程仓库中, 这里建议将服务对外的 proto 文件放到同一个远程仓库中, 虽然也可以通过直接拉取服务的代码仓库来获取依赖的 proto 文件, 但这里会拉取除了 proto 之外的很多不必要的代码文件.

然后在本项目的 WORKSPAC E文件中, 添加拉取 proto 文件统一管理的远程仓库的目标规则, 如下:

步骤2: 将 proto 目标加入到使用者的目标依赖中

这里主要是使用框架封装的 trpc_proto_library 规则, 实现 proto 目标之间的依赖管理.

比如: 本服务的 proto 文件中 import 了其它服务的 proto 文件, 可以参考以下的写法:

比如: 本服务的某个代码文件需要调用其它服务, 可以参考以下的写法:
